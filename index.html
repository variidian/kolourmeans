<!DOCTYPE html>
<html>
  <head>
    <link href="./output.css" rel="stylesheet">
    <meta charset="UTF-8" />
    <title>Hallo!</title>
  </head>
  <body class="bg-slate-900">
<h1 class="text-center text-emerald-600 text-3xl mb-2 font-semibold font-mono">Heya! zoom into a point on the map and click it to generate a colour palette.</h1>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<div id="map" style="height:400px;" class="border-4 border-emerald-600 m-4"></div>
<img id="map_image_elem" class="m-4 border-4 border-emerald-600">
<script>
const path = require('path') /*npm libraries*/
const getColors = require('get-image-colors')
const axios = require("axios");
const fs = require('fs');
const options = { /*option for get-image-colors*/
  count: 50,
  type: 'image/jpeg'
}
var map = L.map('map').setView([0,0], 3);
L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
  attribution: 'Google Satellite', maxZoom: 19
}).addTo(map);
map.on('click', async function(click) {
var zoom = map.getZoom(); /*zoom,tileX,tileY converts from latitude/longitude to use when getting small image of place*/
var latLng = click.latlng; /* latlng (latitude/longitude) and point gets the place the user wants to turn into colour palette*/
var point = map.project(latLng, zoom); 
var tileX = Math.floor(point.x / 256);
var tileY = Math.floor(point.y / 256); 
console.log(tileX,tileY,zoom);
let imageurl = `https://mt1.google.com/vt/lyrs=s&x=${tileX}&y=${tileY}&z=${zoom}`; /*showing the original img on the app*/
let image_elem = document.getElementById('map_image_elem')
image_elem.src = imageurl;
let img_buffer = await urltobuffer(`https://mt1.google.com/vt/lyrs=s&x=${tileX}&y=${tileY}&z=${zoom}`);
getColors(img_buffer, options).then(colors => {
let img_colours = colors.map(color => color.hex());
console.log(img_colours);
})
}
)
async function urltobuffer(url) { /*turn image url to buffer so it can be used in get-image-colours using axios*/
  const response = await axios.get(url, {
    responseType: 'arraybuffer'
  });
  return Buffer.from(response.data); /*turn array buffer to node js buffer*/
}
</script>
</body>
</html>